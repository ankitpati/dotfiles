.import filename.csv tablename --csv
create table nextdns_log ( timestamp timestamp, domain text, query_type text, dnssec text, protocol text, client_ip text, status text, reasons text, destination_country text, root_domain text, device_id text, device_name text, device_model text, device_local_ip text, matched_name text, client_name text );
insert into new_tablename select * from old_tablename;
select datetime(timestamp, 'localtime'), client_ip, domain from nextdns_log order by timestamp desc;
with data_table as ( select timestamp, client_ip as ip, domain, lag(client_ip) over(order by timestamp desc) as next_ip from nextdns_log ), ip_change_table as ( select timestamp, ip, domain, lag(timestamp) over(order by timestamp desc) as next_ip_timestamp from data_table where ip != next_ip ) select datetime(timestamp, 'localtime') as localtime, ip, domain, (unixepoch(next_ip_timestamp) - unixepoch(timestamp)) / 60 as timediff_minute from ip_change_table where timediff_minute > 3;
with data_table as ( select timestamp, client_ip as ip, domain, lag(timestamp) over(order by timestamp desc) as next_timestamp from nextdns_log ) select datetime(timestamp, 'localtime') as localtime, ip, domain, (unixepoch(next_timestamp) - unixepoch(timestamp)) / 60 as timediff_minute from data_table where timediff_minute > 5 order by timestamp desc;
